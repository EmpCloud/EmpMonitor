const _0x41ed3a=_0x585b;(function(_0x121894,_0x4a9ca7){const _0x18442a=_0x585b,_0x555676=_0x121894();while(!![]){try{const _0x562aa0=parseInt(_0x18442a(0x183))/0x1+-parseInt(_0x18442a(0x162))/0x2+parseInt(_0x18442a(0x18d))/0x3+parseInt(_0x18442a(0x166))/0x4+-parseInt(_0x18442a(0x17d))/0x5+parseInt(_0x18442a(0x172))/0x6+-parseInt(_0x18442a(0x189))/0x7*(-parseInt(_0x18442a(0x18f))/0x8);if(_0x562aa0===_0x4a9ca7)break;else _0x555676['push'](_0x555676['shift']());}catch(_0x5e9c2d){_0x555676['push'](_0x555676['shift']());}}}(_0x5ebc,0xb6109));function _0x585b(_0x2d1743,_0x30c1bf){const _0x5ebcc6=_0x5ebc();return _0x585b=function(_0x585b1c,_0x4a4e20){_0x585b1c=_0x585b1c-0x15d;let _0x212b2a=_0x5ebcc6[_0x585b1c];return _0x212b2a;},_0x585b(_0x2d1743,_0x30c1bf);}const ReportModel=require('./reports.model'),moment=require(_0x41ed3a(0x173)),_=require(_0x41ed3a(0x16a));class ReportsController{async[_0x41ed3a(0x188)](_0x53b368,_0x21bbe5,_0x4c8213){const _0x2d67a6=_0x41ed3a;let _0x481990=_0x53b368['user'];console[_0x2d67a6(0x179)](_0x481990);try{let {..._0x5db20c}=_0x53b368['body'],_0x325bf6={'employee_id':_0x481990['id'],..._0x5db20c},_0x2279fa=[];for(const _0x4ce64b of _0x325bf6[_0x2d67a6(0x161)]){let _0x438157=moment[_0x2d67a6(0x15d)](_0x4ce64b[_0x2d67a6(0x190)]);for(let _0x3c306b of _0x4ce64b[_0x2d67a6(0x15f)]){let _0x12d1a0=_0x3c306b[_0x2d67a6(0x16c)],_0x208a28=_0x3c306b[_0x2d67a6(0x171)],_0x266b88=moment[_0x2d67a6(0x15d)](_0x438157)[_0x2d67a6(0x185)](_0x12d1a0,_0x2d67a6(0x168)),_0x376b64=moment[_0x2d67a6(0x15d)](_0x438157)[_0x2d67a6(0x185)](_0x208a28,_0x2d67a6(0x168)),_0x32aa9e=_0x4ce64b[_0x2d67a6(0x186)]['keystrokes']['slice'](_0x12d1a0,_0x208a28)[_0x2d67a6(0x16d)](_0x12ef23=>+_0x12ef23!==0x0)[_0x2d67a6(0x184)],_0x49d7da=_0x4ce64b[_0x2d67a6(0x186)][_0x2d67a6(0x175)][_0x2d67a6(0x180)](_0x12d1a0,_0x208a28)[_0x2d67a6(0x16d)](_0x16a3a1=>+_0x16a3a1!==0x0)[_0x2d67a6(0x184)],_0x2791e3=_0x4ce64b['activityPerSecond'][_0x2d67a6(0x16b)]['slice'](_0x12d1a0,_0x208a28)[_0x2d67a6(0x16d)](_0x4c5d87=>+_0x4c5d87!==0x0)[_0x2d67a6(0x184)];_0x12d1a0===_0x208a28&&(_0x208a28=_0x208a28+0x1);let {active_seconds:_0x3cfd71,total_seconds:_0x1c2288}=calculateActivity(_0x12d1a0,_0x208a28,_0x4ce64b[_0x2d67a6(0x186)],_0x4ce64b[_0x2d67a6(0x15f)]),_0x37c8ef=null,_0x1fbd5a=null;if(_0x3c306b[_0x2d67a6(0x18a)]&&_0x3c306b[_0x2d67a6(0x18a)]['trim']()!==''){const _0x221722=await ReportModel[_0x2d67a6(0x191)](_0x481990[_0x2d67a6(0x18b)]||0x1,0x1,_0x3c306b[_0x2d67a6(0x18a)]);_0x37c8ef=_0x221722[_0x2d67a6(0x170)];}if(_0x3c306b[_0x2d67a6(0x17e)]&&_0x3c306b['url'][_0x2d67a6(0x181)]()!==''){const _0x39942a=ReportModel[_0x2d67a6(0x17b)](_0x3c306b[_0x2d67a6(0x17e)]);if(_0x39942a){const _0x3b30dc=await ReportModel['findOrCreateOrgAppWeb'](_0x481990[_0x2d67a6(0x18b)]||0x1,0x2,_0x39942a);_0x1fbd5a=_0x3b30dc['_id'];}}let _0x2f7165;const _0x385c64=await ReportModel['findMergeableRecord'](_0x481990['id'],_0x3c306b[_0x2d67a6(0x18a)],_0x3c306b['title'],_0x3c306b[_0x2d67a6(0x17e)],_0x266b88[_0x2d67a6(0x164)]());if(_0x385c64){const _0x3b669f={'end_time':_0x376b64[_0x2d67a6(0x164)](),'keystrokes':_0x385c64[_0x2d67a6(0x17f)]+(_0x3c306b['keystrokes']??''),'keystrokesCount':_0x385c64[_0x2d67a6(0x165)]+_0x32aa9e,'mouseMovementsCount':_0x385c64[_0x2d67a6(0x163)]+_0x49d7da,'buttonClicks':_0x385c64[_0x2d67a6(0x16b)]+_0x2791e3,'active_seconds':_0x385c64[_0x2d67a6(0x187)]+_0x3cfd71,'total_seconds':_0x385c64[_0x2d67a6(0x15e)]+_0x1c2288,'idle_seconds':_0x385c64[_0x2d67a6(0x178)]+(_0x1c2288-_0x3cfd71)};_0x37c8ef&&!_0x385c64[_0x2d67a6(0x177)]&&(_0x3b669f[_0x2d67a6(0x177)]=_0x37c8ef),_0x1fbd5a&&!_0x385c64['domain_id']&&(_0x3b669f[_0x2d67a6(0x16e)]=_0x1fbd5a),_0x2f7165=await ReportModel[_0x2d67a6(0x174)](_0x385c64[_0x2d67a6(0x170)],_0x3b669f);}else _0x2f7165=await ReportModel[_0x2d67a6(0x169)]({'employee_id':_0x481990['id'],'organization_id':_0x481990[_0x2d67a6(0x18b)]||0x1,'application_id':_0x37c8ef,'domain_id':_0x1fbd5a,'application_name':_0x3c306b[_0x2d67a6(0x18a)],'title':_0x3c306b['title'],'url':_0x3c306b['url'],'start_time':_0x266b88[_0x2d67a6(0x164)](),'end_time':_0x376b64[_0x2d67a6(0x164)](),'yyyymmdd':_0x438157[_0x2d67a6(0x182)]('YYYYMMDD'),'keystrokes':_0x3c306b[_0x2d67a6(0x17f)]??'','keystrokesCount':_0x32aa9e,'mouseMovementsCount':_0x49d7da,'buttonClicks':_0x2791e3,'active_seconds':_0x3cfd71,'total_seconds':_0x1c2288,'idle_seconds':_0x1c2288-_0x3cfd71});_0x2279fa[_0x2d67a6(0x176)](_0x2f7165);}}return _0x21bbe5[_0x2d67a6(0x160)](0xc8)[_0x2d67a6(0x18c)]({'code':0xc8,'message':_0x2d67a6(0x16f),'data':_0x2279fa});}catch(_0x449ca9){console[_0x2d67a6(0x179)](_0x449ca9),_0x4c8213(_0x449ca9);}}}function _0x5ebc(){const _0x1adb47=['some','5585570iZnoYv','url','keystrokes','slice','trim','format','212770ttJAxI','length','add','activityPerSecond','active_seconds','addData','2075206hqynfX','app','organization_id','json','474831ePebdb','chunk','56pVFPsF','dataId','findOrCreateOrgAppWeb','utc','total_seconds','appUsage','status','data','2392936hOmQJX','mouseMovementsCount','toISOString','keystrokesCount','1813516pptMlV','exports','second','addAppUsage','underscore','buttonClicks','start','filter','domain_id','Data\x20added\x20successfully','_id','end','958122OTZzjP','moment-timezone','updateRecord','mouseMovements','push','application_id','idle_seconds','log','reduce','extractDomain'];_0x5ebc=function(){return _0x1adb47;};return _0x5ebc();}module[_0x41ed3a(0x167)]=new ReportsController();const calculateActivity=(_0x406253,_0x299335,_0x6728da,_0x4d25eb)=>{const _0x518e94=_0x41ed3a;let {buttonClicks:_0x794329,fakeActivities:_0x2d9af2,keystrokes:_0x5ca37e,mouseMovements:_0x5e66c9}=_0x6728da;const _0x35a009=_0x794329[_0x518e94(0x184)]!==_0x4d25eb[_0x4d25eb['length']-0x1][_0x518e94(0x171)]&&_0x794329[_0x518e94(0x184)]==_0x4d25eb[_0x4d25eb[_0x518e94(0x184)]-0x1][_0x518e94(0x171)]+0x1&&_0x4d25eb[_0x4d25eb['length']-0x1]['end']==_0x299335&&!(_0x794329[_0x518e94(0x184)]-0x1==_0x406253);_0x35a009?(_0x794329=_0x794329[_0x518e94(0x180)](_0x406253,_0x4d25eb[_0x4d25eb[_0x518e94(0x184)]-0x1][_0x518e94(0x171)]+0x1),_0x2d9af2=_0x2d9af2[_0x518e94(0x180)](_0x406253,_0x4d25eb[_0x4d25eb[_0x518e94(0x184)]-0x1][_0x518e94(0x171)]+0x1),_0x5ca37e=_0x5ca37e[_0x518e94(0x180)](_0x406253,_0x4d25eb[_0x4d25eb[_0x518e94(0x184)]-0x1][_0x518e94(0x171)]+0x1),_0x5e66c9=_0x5e66c9[_0x518e94(0x180)](_0x406253,_0x4d25eb[_0x4d25eb[_0x518e94(0x184)]-0x1]['end']+0x1)):(_0x794329=_0x794329[_0x518e94(0x180)](_0x406253,_0x299335),_0x2d9af2=_0x2d9af2[_0x518e94(0x180)](_0x406253,_0x299335),_0x5ca37e=_0x5ca37e['slice'](_0x406253,_0x299335),_0x5e66c9=_0x5e66c9[_0x518e94(0x180)](_0x406253,_0x299335));const _0x56cfff=_['chunk'](_0x794329,0x3c),_0x56448f=_['chunk'](_0x2d9af2,0x3c),_0x436e9a=_[_0x518e94(0x18e)](_0x5ca37e,0x3c),_0x373287=_[_0x518e94(0x18e)](_0x5e66c9,0x3c),_0xef3900=_0x56cfff[_0x518e94(0x17a)]((_0x585de2,_0x3a0f04,_0x3757dd,_0x30e77f)=>{const _0x44e6dd=_0x518e94;return _0x56cfff[_0x3757dd][_0x44e6dd(0x17c)](_0x59355a=>_0x59355a>0x0)||_0x56448f[_0x3757dd]['some'](_0x514ea5=>_0x514ea5>0x0)||_0x436e9a[_0x3757dd][_0x44e6dd(0x17c)](_0x238dd0=>_0x238dd0>0x0)||_0x373287[_0x3757dd][_0x44e6dd(0x17c)](_0x47bd72=>_0x47bd72>0x0)?_0x585de2+_0x3a0f04[_0x44e6dd(0x184)]:_0x585de2+0x0;},0x0);return{'active_seconds':_0xef3900,'total_seconds':_0x299335-_0x406253,'mouseclicks_count':_0x794329['filter'](_0x37dfbe=>_0x37dfbe!==0x0)['length'],'keystrokes_count':_0x5ca37e[_0x518e94(0x16d)](_0xeb7bd7=>_0xeb7bd7!==0x0)[_0x518e94(0x184)],'mousemovement_count':_0x5e66c9['filter'](_0x13dea5=>_0x13dea5!==0x0)[_0x518e94(0x184)],'condition':_0x35a009,'chunkData':{'buttonClickChunks':_0x56cfff,'fakeActivityChunks':_0x56448f,'keystrokeChunks':_0x436e9a,'mouseMovementChunks':_0x373287}};};