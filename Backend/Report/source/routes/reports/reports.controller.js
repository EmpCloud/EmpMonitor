function _0x3705(_0x449533,_0x2d9320){const _0xdf3dd4=_0xdf3d();return _0x3705=function(_0x370585,_0x5cf868){_0x370585=_0x370585-0x7e;let _0x39f737=_0xdf3dd4[_0x370585];return _0x39f737;},_0x3705(_0x449533,_0x2d9320);}const _0x5b4977=_0x3705;(function(_0x1e1ef8,_0x2cb6ee){const _0x4c254f=_0x3705,_0x2e722b=_0x1e1ef8();while(!![]){try{const _0x74c3a4=parseInt(_0x4c254f(0xb4))/0x1+parseInt(_0x4c254f(0x9d))/0x2+parseInt(_0x4c254f(0x82))/0x3*(-parseInt(_0x4c254f(0x8c))/0x4)+parseInt(_0x4c254f(0xa2))/0x5*(-parseInt(_0x4c254f(0x94))/0x6)+-parseInt(_0x4c254f(0x88))/0x7+parseInt(_0x4c254f(0x91))/0x8+-parseInt(_0x4c254f(0x86))/0x9;if(_0x74c3a4===_0x2cb6ee)break;else _0x2e722b['push'](_0x2e722b['shift']());}catch(_0x1a4bfd){_0x2e722b['push'](_0x2e722b['shift']());}}}(_0xdf3d,0x2e93a));const ReportModel=require('./reports.model'),moment=require(_0x5b4977(0x97)),_=require(_0x5b4977(0x99));function _0xdf3d(){const _0x4e241d=['126fPaXcF','active_seconds','organization_id','moment-timezone','addData','underscore','keystrokesCount','some','productive_seconds','200570ikLbpY','filter','trim','dataId','activityPerSecond','2605jOIrFF','reduce','_id','category','buttonClicks','app','application_id','url','domain_id','total_seconds','end','keystrokes','title','length','extractDomain','findMergeableRecord','add','log','349824yDijWj','Data\x20added\x20successfully','format','user','toISOString','526236BgmBLC','chunk','appUsage','mouseMovements','369927hpCPOg','unproductive_seconds','462623ZJSFfu','YYYYMMDD','slice','data','8NDMJCO','second','body','json','findOrCreateOrgAppWeb','1677008NYxxbw','neutral_seconds','utc'];_0xdf3d=function(){return _0x4e241d;};return _0xdf3d();}class ReportsController{async[_0x5b4977(0x98)](_0x4c6104,_0x2a9f04,_0x4ee776){const _0x380dd0=_0x5b4977;let _0x2541c5=_0x4c6104[_0x380dd0(0x80)];console[_0x380dd0(0xb3)](_0x2541c5);try{let {..._0x372751}=_0x4c6104[_0x380dd0(0x8e)],_0x20247b={'employee_id':_0x2541c5['id'],..._0x372751},_0x2947cf=[];for(const _0x50d7fa of _0x20247b[_0x380dd0(0x8b)]){let _0x5e89d3=moment[_0x380dd0(0x93)](_0x50d7fa[_0x380dd0(0xa0)]);for(let _0x4dbab8 of _0x50d7fa[_0x380dd0(0x84)]){let _0x15aaa6=_0x4dbab8['start'],_0x392d18=_0x4dbab8[_0x380dd0(0xac)],_0x1a67a2=moment[_0x380dd0(0x93)](_0x5e89d3)['add'](_0x15aaa6,_0x380dd0(0x8d)),_0xc7c4ea=moment[_0x380dd0(0x93)](_0x5e89d3)[_0x380dd0(0xb2)](_0x392d18,_0x380dd0(0x8d)),_0x4567bd=_0x50d7fa[_0x380dd0(0xa1)][_0x380dd0(0xad)]['slice'](_0x15aaa6,_0x392d18)['filter'](_0x41bb5e=>+_0x41bb5e!==0x0)[_0x380dd0(0xaf)],_0x2be3bc=_0x50d7fa[_0x380dd0(0xa1)][_0x380dd0(0x85)]['slice'](_0x15aaa6,_0x392d18)['filter'](_0x49e5a8=>+_0x49e5a8!==0x0)[_0x380dd0(0xaf)],_0x4188ab=_0x50d7fa[_0x380dd0(0xa1)][_0x380dd0(0xa6)]['slice'](_0x15aaa6,_0x392d18)['filter'](_0x12f637=>+_0x12f637!==0x0)['length'];_0x15aaa6===_0x392d18&&(_0x392d18=_0x392d18+0x1);let {active_seconds:_0x226487,total_seconds:_0x2e194c}=calculateActivity(_0x15aaa6,_0x392d18,_0x50d7fa[_0x380dd0(0xa1)],_0x50d7fa[_0x380dd0(0x84)]),_0x20556b=null,_0x58e6d9=null,_0x191bec=null;if(_0x4dbab8[_0x380dd0(0xa7)]&&_0x4dbab8[_0x380dd0(0xa7)]['trim']()!==''){const _0x7b235b=await ReportModel[_0x380dd0(0x90)](_0x2541c5[_0x380dd0(0x96)]||0x1,0x1,_0x4dbab8[_0x380dd0(0xa7)]);_0x20556b=_0x7b235b[_0x380dd0(0xa4)],_0x191bec=_0x7b235b;}if(_0x4dbab8['url']&&_0x4dbab8['url'][_0x380dd0(0x9f)]()!==''){const _0x70720a=ReportModel[_0x380dd0(0xb0)](_0x4dbab8[_0x380dd0(0xa9)]);if(_0x70720a){const _0x29e74a=await ReportModel['findOrCreateOrgAppWeb'](_0x2541c5[_0x380dd0(0x96)]||0x1,0x2,_0x70720a);_0x58e6d9=_0x29e74a[_0x380dd0(0xa4)],_0x191bec=_0x29e74a;}}let _0xd63741;const _0x3a53c3=await ReportModel[_0x380dd0(0xb1)](_0x2541c5['id'],_0x4dbab8[_0x380dd0(0xa7)],_0x4dbab8[_0x380dd0(0xae)],_0x4dbab8[_0x380dd0(0xa9)],_0x1a67a2[_0x380dd0(0x81)]());if(_0x3a53c3){const _0x55ecc1={'end_time':_0xc7c4ea[_0x380dd0(0x81)](),'keystrokes':_0x3a53c3[_0x380dd0(0xad)]+(_0x4dbab8[_0x380dd0(0xad)]??''),'keystrokesCount':_0x3a53c3[_0x380dd0(0x9a)]+_0x4567bd,'mouseMovementsCount':_0x3a53c3['mouseMovementsCount']+_0x2be3bc,'buttonClicks':_0x3a53c3[_0x380dd0(0xa6)]+_0x4188ab,'active_seconds':_0x3a53c3[_0x380dd0(0x95)]+_0x226487,'total_seconds':_0x3a53c3[_0x380dd0(0xab)]+_0x2e194c,'idle_seconds':_0x3a53c3['idle_seconds']+(_0x2e194c-_0x226487)};_0x20556b&&!_0x3a53c3[_0x380dd0(0xa8)]&&(_0x55ecc1[_0x380dd0(0xa8)]=_0x20556b);_0x58e6d9&&!_0x3a53c3[_0x380dd0(0xaa)]&&(_0x55ecc1[_0x380dd0(0xaa)]=_0x58e6d9);if(_0x191bec&&_0x191bec[_0x380dd0(0xa5)]==0x0)_0x55ecc1['neutral_seconds']=_0x3a53c3[_0x380dd0(0x92)]+_0x226487;else{if(_0x191bec&&_0x191bec[_0x380dd0(0xa5)]==0x1)_0x55ecc1[_0x380dd0(0x9c)]=_0x3a53c3[_0x380dd0(0x9c)]+_0x226487;else _0x191bec&&_0x191bec[_0x380dd0(0xa5)]==0x2&&(_0x55ecc1['unproductive_seconds']=_0x3a53c3[_0x380dd0(0x87)]+_0x226487);}_0xd63741=await ReportModel['updateRecord'](_0x3a53c3[_0x380dd0(0xa4)],_0x55ecc1);}else _0xd63741=await ReportModel['addAppUsage']({'employee_id':_0x2541c5['id'],'organization_id':_0x2541c5['organization_id']||0x1,'application_id':_0x20556b,'domain_id':_0x58e6d9,'application_name':_0x4dbab8[_0x380dd0(0xa7)],'title':_0x4dbab8[_0x380dd0(0xae)],'url':_0x4dbab8[_0x380dd0(0xa9)],'start_time':_0x1a67a2[_0x380dd0(0x81)](),'end_time':_0xc7c4ea[_0x380dd0(0x81)](),'yyyymmdd':_0x5e89d3[_0x380dd0(0x7f)](_0x380dd0(0x89)),'keystrokes':_0x4dbab8[_0x380dd0(0xad)]??'','keystrokesCount':_0x4567bd,'mouseMovementsCount':_0x2be3bc,'buttonClicks':_0x4188ab,'active_seconds':_0x226487,'total_seconds':_0x2e194c,'idle_seconds':_0x2e194c-_0x226487,'neutral_seconds':_0x191bec&&_0x191bec['category']==0x0?_0x226487:0x0,'productive_seconds':_0x191bec&&_0x191bec['category']==0x1?_0x226487:0x0,'unproductive_seconds':_0x191bec&&_0x191bec['category']==0x2?_0x226487:0x0});_0x2947cf['push'](_0xd63741);}}return _0x2a9f04['status'](0xc8)[_0x380dd0(0x8f)]({'code':0xc8,'message':_0x380dd0(0x7e),'data':_0x2947cf});}catch(_0x1df960){console['log'](_0x1df960),_0x4ee776(_0x1df960);}}}module['exports']=new ReportsController();const calculateActivity=(_0x1cd9fb,_0x5320f5,_0x2eae06,_0x4bcf47)=>{const _0x10c0c3=_0x5b4977;let {buttonClicks:_0x2ef895,fakeActivities:_0x3ae7fa,keystrokes:_0x239a70,mouseMovements:_0x275df0}=_0x2eae06;const _0x38b19c=_0x2ef895[_0x10c0c3(0xaf)]!==_0x4bcf47[_0x4bcf47[_0x10c0c3(0xaf)]-0x1][_0x10c0c3(0xac)]&&_0x2ef895[_0x10c0c3(0xaf)]==_0x4bcf47[_0x4bcf47[_0x10c0c3(0xaf)]-0x1][_0x10c0c3(0xac)]+0x1&&_0x4bcf47[_0x4bcf47['length']-0x1][_0x10c0c3(0xac)]==_0x5320f5&&!(_0x2ef895['length']-0x1==_0x1cd9fb);_0x38b19c?(_0x2ef895=_0x2ef895[_0x10c0c3(0x8a)](_0x1cd9fb,_0x4bcf47[_0x4bcf47['length']-0x1][_0x10c0c3(0xac)]+0x1),_0x3ae7fa=_0x3ae7fa[_0x10c0c3(0x8a)](_0x1cd9fb,_0x4bcf47[_0x4bcf47['length']-0x1]['end']+0x1),_0x239a70=_0x239a70[_0x10c0c3(0x8a)](_0x1cd9fb,_0x4bcf47[_0x4bcf47[_0x10c0c3(0xaf)]-0x1][_0x10c0c3(0xac)]+0x1),_0x275df0=_0x275df0[_0x10c0c3(0x8a)](_0x1cd9fb,_0x4bcf47[_0x4bcf47[_0x10c0c3(0xaf)]-0x1][_0x10c0c3(0xac)]+0x1)):(_0x2ef895=_0x2ef895[_0x10c0c3(0x8a)](_0x1cd9fb,_0x5320f5),_0x3ae7fa=_0x3ae7fa[_0x10c0c3(0x8a)](_0x1cd9fb,_0x5320f5),_0x239a70=_0x239a70['slice'](_0x1cd9fb,_0x5320f5),_0x275df0=_0x275df0['slice'](_0x1cd9fb,_0x5320f5));const _0x1c66ac=_['chunk'](_0x2ef895,0x3c),_0x221d90=_['chunk'](_0x3ae7fa,0x3c),_0x27d82b=_['chunk'](_0x239a70,0x3c),_0x21d1c3=_[_0x10c0c3(0x83)](_0x275df0,0x3c),_0x1d0df8=_0x1c66ac[_0x10c0c3(0xa3)]((_0x37500b,_0x51935c,_0x19a167,_0x1390aa)=>{const _0x53f9f3=_0x10c0c3;return _0x1c66ac[_0x19a167][_0x53f9f3(0x9b)](_0x4faa02=>_0x4faa02>0x0)||_0x221d90[_0x19a167][_0x53f9f3(0x9b)](_0x561da7=>_0x561da7>0x0)||_0x27d82b[_0x19a167]['some'](_0x6bc399=>_0x6bc399>0x0)||_0x21d1c3[_0x19a167][_0x53f9f3(0x9b)](_0x43128f=>_0x43128f>0x0)?_0x37500b+_0x51935c['length']:_0x37500b+0x0;},0x0);return{'active_seconds':_0x1d0df8,'total_seconds':_0x5320f5-_0x1cd9fb,'mouseclicks_count':_0x2ef895[_0x10c0c3(0x9e)](_0x173d77=>_0x173d77!==0x0)['length'],'keystrokes_count':_0x239a70['filter'](_0x18fa2c=>_0x18fa2c!==0x0)[_0x10c0c3(0xaf)],'mousemovement_count':_0x275df0['filter'](_0x2bcb35=>_0x2bcb35!==0x0)[_0x10c0c3(0xaf)],'condition':_0x38b19c,'chunkData':{'buttonClickChunks':_0x1c66ac,'fakeActivityChunks':_0x221d90,'keystrokeChunks':_0x27d82b,'mouseMovementChunks':_0x21d1c3}};};